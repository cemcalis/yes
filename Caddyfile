ravorcollection.com, www.ravorcollection.com {
	encode gzip

	# Redirect requests that came to www to the apex canonical domain
	@host_www {
		host www.ravorcollection.com
	}
	redir @host_www https://ravorcollection.com{uri} permanent

	# Reverse proxy API requests to backend service in the Docker network
	@api {
		path /api/*
	}
	reverse_proxy @api backend:5000

	# Serve uploaded files via backend without stripping /uploads prefix
	@uploads {
		path /uploads/*
	}
	# Instruct browsers and CDNs to cache uploads aggressively
	header @uploads Cache-Control "public, max-age=31536000, immutable"
	reverse_proxy @uploads backend:5000

	# Proxy everything else to the frontend (Next.js) service
	reverse_proxy /* frontend:3000

	# Obtain TLS automatically via Let's Encrypt for both names
	tls admin@ravorcollection.com
}
